syntax = "proto3";
import "exa.codeium_common_pb.proto";
import "exa.language_server_pb.proto";
import "exa.cortex_pb.proto";

import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";

package exa.extension_server_pb;
message LanguageServerStartedRequest {  int32 language_server_port = 1;
  int32 lsp_port = 2;
  int32 chat_client_port = 3;
  string csrf_token = 4;
}

message LanguageServerStartedResponse {}

message OpenSettingRequest {  string setting_id = 1;
}

message OpenSettingResponse {}

message OpenFilePointerRequest {  string file_uri = 1;
  int32 start_line = 2;
  int32 start_col = 3;
  int32 end_line = 4;
  int32 end_col = 5;
  bool is_cascade_diff = 6;
}

message OpenFilePointerResponse {}

message InsertCodeAtCursorRequest {  string text = 1;
  exa.extension_server_pb.ActiveEditorType editor_type = 2;
}

message InsertCodeAtCursorResponse {}

message EventMetadataRecord {  string key = 1;
  string value = 2;
}

message LogEventRequest {  exa.codeium_common_pb.ProductEventType event = 1;
  string event_string = 3;
  repeated exa.extension_server_pb.EventMetadataRecord metadata = 2;
}

message LogEventResponse {}

message CheckTerminalShellSupportRequest {}

message CheckTerminalShellSupportResponse {  bool has_shell_integration = 1;
  string shell_name = 2;
  string shell_path = 3;
}

message ExecuteCommandRequest {  string command_line = 5;
  string cwd = 3;
  string terminal_id = 4;
}

message ShowTerminalRequest {  string terminal_id = 1;
}

message ShowTerminalResponse {}

message OpenVirtualFileRequest {  string text = 1;
  bool show_markdown_preview = 2;
}

message OpenVirtualFileResponse {}

message SaveDocumentRequest {  string uri = 1;
}

message SaveDocumentResponse {}

message ReadTerminalRequest {  string process_id = 1;
}

message ReadTerminalResponse {  string contents = 1;
}

message OpenTerminalRequest {  string process_id = 1;
}

message OpenTerminalResponse {}

message AwaitNewLintsConfig {  string acknowledger_id = 1;
  int32 timeout_ms = 2;
  int32 grace_period_ms = 3;
  bool include_saved = 4;
}

message GetLintErrorsRequest {  exa.extension_server_pb.AwaitNewLintsConfig await_new_lints_config = 1;
}

message GetLintErrorsResponse {  repeated exa.codeium_common_pb.CodeDiagnostic lint_errors = 1;
  repeated exa.codeium_common_pb.CodeDiagnostic persistent_lint_errors = 2;
}

message OpenDiffZonesRequest {  string cascade_id = 1;
  repeated exa.language_server_pb.ValidationState validation_states = 2;
  bool write_new_state = 3;
}

message OpenDiffZonesResponse {}

message OpenExternalUrlRequest {  string url = 1;
  bool use_ide_browser = 2;
}

message OpenExternalUrlResponse {}

message OpenMultiDiffRequest {  string cascade_id = 1;
}

message OpenMultiDiffResponse {}

message HandleAsyncPostMessageRequest {  string message_type = 1;
  string message_content = 2;
}

message HandleAsyncPostMessageResponse {  string response_content = 1;
}

message PlaySoundRequest {  exa.extension_server_pb.SoundType sound_type = 1;
}

message PlaySoundResponse {}

message OpenWindsurfRulesFileRequest {  bool is_workspace_rules = 1;
}

message OpenWindsurfRulesFileResponse {}

message DeleteWindsurfRulesFileRequest {  bool is_workspace_rules = 1;
}

message DeleteWindsurfRulesFileResponse {}

message OpenPluginPageRequest {  string plugin_id = 4;
}

message OpenPluginPageResponse {}

message OpenPluginConfigModalRequest {  string plugin_id = 3;
}

message OpenPluginConfigModalResponse {}

message OpenConfigurePluginsPageRequest {  string server_name = 1;
}

message OpenConfigurePluginsPageResponse {}

message OpenConversationWorkspaceQuickPickRequest {  string cascade_id = 1;
  repeated string workspace_uris = 2;
}

message OpenConversationWorkspaceQuickPickResponse {  bool open_in_current_window = 1;
}

message FindAllReferencesRequest {  string file_uri = 1;
  string symbol = 2;
  uint32 line = 3;
  uint32 occurrence_index = 4;
}

message FindAllReferencesResponse {  repeated exa.codeium_common_pb.LspReference references = 1;
}

message GetDefinitionRequestItem {  string file_uri = 1;
  exa.codeium_common_pb.DocumentPosition position = 2;
  string line_content = 3;
}

message GetDefinitionRequest {  repeated exa.extension_server_pb.GetDefinitionRequestItem request = 1;
}

message GetDefinitionResponseItem {  repeated exa.codeium_common_pb.LspReference definitions = 1;
  exa.codeium_common_pb.GRPCStatus status = 2;
}

message GetDefinitionResponse {  repeated exa.extension_server_pb.GetDefinitionResponseItem response = 1;
}

message RefreshURIsRequest {  repeated string uris = 1;
}

message RefreshURIsResponse {}

message CheckExperimentRequest {  string experiment_key = 1;
  map<string, string> context_overrides = 2;
}

message ExperimentPayload {  string type = 1;
  string value = 2;
}

message ExperimentVariant {  string name = 1;
  exa.extension_server_pb.ExperimentPayload payload = 2;
}

message CheckExperimentResponse {  bool enabled = 1;
  exa.extension_server_pb.ExperimentVariant variant = 2;
  string error_message = 3;
}

message TerminalResearchResultRequest {  exa.cortex_pb.CortexTrajectoryStep last_step = 1;
}

message TerminalResearchResultResponse {}

message WriteCascadeEditRequest {  string uri = 1;
  string target_content = 2;
}

message WriteCascadeEditResponse {}

message StartAudioRecordingRequest {}

message StartAudioRecordingResponse {}

message EndAudioRecordingRequest {}

message EndAudioRecordingResponse {  string transcription = 1;
}

message GetCurrentAudioRecordingRequest {}

message GetCurrentAudioRecordingResponse {  float average_volume = 2;
}

message HandleProposeCodeExtensionVerificationRequest {  exa.cortex_pb.CortexTrajectoryStep step = 1;
}

message HandleProposeCodeExtensionVerificationResponse {}

message UpdateCascadeTrajectorySummariesRequest {  exa.cortex_pb.CascadeTrajectorySummaries summaries = 1;
}

message UpdateCascadeTrajectorySummariesResponse {}

message RunExtensionCodeRequest {  string code = 1;
}

message RunExtensionCodeResponse {  string output = 1;
}

message AddAnnotationRequest {  exa.codeium_common_pb.CodeAnnotation annotation = 1;
}

message AddAnnotationResponse {}

message RemoveAnnotationRequest {  string annotation_id = 1;
}

message RemoveAnnotationResponse {}

message ShowAnnotationRequest {  string annotation_id = 1;
}

message ShowAnnotationResponse {}

message GetSecretValueRequest {  string key = 1;
}

message GetSecretValueResponse {  string value = 1;
}

message StoreSecretValueRequest {  string key = 1;
  string value = 2;
}

message StoreSecretValueResponse {}

message CancelVibeAndReplaceRequest {}

message CancelVibeAndReplaceResponse {}

message SearchQueryRequest {  string query = 1;
  int32 max_results = 2;
  string cache_key = 3;
}

message SearchQueryResponse {  repeated string result_uris = 1;
}

message GetClaudeCodeVersionRequest {}

message GetClaudeCodeVersionResponse {  string version = 1;
}

enum ActiveEditorType {  ACTIVE_EDITOR_TYPE_UNSPECIFIED = 0;  ACTIVE_EDITOR_TYPE_TEXT_EDITOR = 1;  ACTIVE_EDITOR_TYPE_TERMINAL = 2;}
enum SoundType {  SOUND_TYPE_UNSPECIFIED = 0;  SOUND_TYPE_CASCADE_DONE = 1;}
service ExtensionServerService {
  rpc LanguageServerStarted(exa.extension_server_pb.LanguageServerStartedRequest) returns (exa.extension_server_pb.LanguageServerStartedResponse);
  rpc OpenSetting(exa.extension_server_pb.OpenSettingRequest) returns (exa.extension_server_pb.OpenSettingResponse);
  rpc OpenFilePointer(exa.extension_server_pb.OpenFilePointerRequest) returns (exa.extension_server_pb.OpenFilePointerResponse);
  rpc InsertCodeAtCursor(exa.extension_server_pb.InsertCodeAtCursorRequest) returns (exa.extension_server_pb.InsertCodeAtCursorResponse);
  rpc LogEvent(exa.extension_server_pb.LogEventRequest) returns (exa.extension_server_pb.LogEventResponse);
  rpc CheckTerminalShellSupport(exa.extension_server_pb.CheckTerminalShellSupportRequest) returns (exa.extension_server_pb.CheckTerminalShellSupportResponse);
  rpc ExecuteCommand(stream exa.extension_server_pb.ExecuteCommandRequest) returns (exa.codeium_common_pb.TerminalShellCommandStreamChunk);
  rpc ShowTerminal(exa.extension_server_pb.ShowTerminalRequest) returns (exa.extension_server_pb.ShowTerminalResponse);
  rpc OpenVirtualFile(exa.extension_server_pb.OpenVirtualFileRequest) returns (exa.extension_server_pb.OpenVirtualFileResponse);
  rpc SaveDocument(exa.extension_server_pb.SaveDocumentRequest) returns (exa.extension_server_pb.SaveDocumentResponse);
  rpc ReadTerminal(exa.extension_server_pb.ReadTerminalRequest) returns (exa.extension_server_pb.ReadTerminalResponse);
  rpc OpenTerminal(exa.extension_server_pb.OpenTerminalRequest) returns (exa.extension_server_pb.OpenTerminalResponse);
  rpc GetLintErrors(exa.extension_server_pb.GetLintErrorsRequest) returns (exa.extension_server_pb.GetLintErrorsResponse);
  rpc OpenDiffZones(exa.extension_server_pb.OpenDiffZonesRequest) returns (exa.extension_server_pb.OpenDiffZonesResponse);
  rpc OpenExternalUrl(exa.extension_server_pb.OpenExternalUrlRequest) returns (exa.extension_server_pb.OpenExternalUrlResponse);
  rpc OpenMultiDiff(exa.extension_server_pb.OpenMultiDiffRequest) returns (exa.extension_server_pb.OpenMultiDiffResponse);
  rpc HandleAsyncPostMessage(exa.extension_server_pb.HandleAsyncPostMessageRequest) returns (exa.extension_server_pb.HandleAsyncPostMessageResponse);
  rpc PlaySound(exa.extension_server_pb.PlaySoundRequest) returns (exa.extension_server_pb.PlaySoundResponse);
  rpc OpenWindsurfRulesFile(exa.extension_server_pb.OpenWindsurfRulesFileRequest) returns (exa.extension_server_pb.OpenWindsurfRulesFileResponse);
  rpc DeleteWindsurfRulesFile(exa.extension_server_pb.DeleteWindsurfRulesFileRequest) returns (exa.extension_server_pb.DeleteWindsurfRulesFileResponse);
  rpc OpenPluginPage(exa.extension_server_pb.OpenPluginPageRequest) returns (exa.extension_server_pb.OpenPluginPageResponse);
  rpc OpenPluginConfigModal(exa.extension_server_pb.OpenPluginConfigModalRequest) returns (exa.extension_server_pb.OpenPluginConfigModalResponse);
  rpc OpenConfigurePluginsPage(exa.extension_server_pb.OpenConfigurePluginsPageRequest) returns (exa.extension_server_pb.OpenConfigurePluginsPageResponse);
  rpc OpenConversationWorkspaceQuickPick(exa.extension_server_pb.OpenConversationWorkspaceQuickPickRequest) returns (exa.extension_server_pb.OpenConversationWorkspaceQuickPickResponse);
  rpc FindAllReferences(exa.extension_server_pb.FindAllReferencesRequest) returns (exa.extension_server_pb.FindAllReferencesResponse);
  rpc GetDefinition(exa.extension_server_pb.GetDefinitionRequest) returns (exa.extension_server_pb.GetDefinitionResponse);
  rpc RefreshURIs(exa.extension_server_pb.RefreshURIsRequest) returns (exa.extension_server_pb.RefreshURIsResponse);
  rpc CheckExperiment(exa.extension_server_pb.CheckExperimentRequest) returns (exa.extension_server_pb.CheckExperimentResponse);
  rpc TerminalResearchResult(exa.extension_server_pb.TerminalResearchResultRequest) returns (exa.extension_server_pb.TerminalResearchResultResponse);
  rpc WriteCascadeEdit(exa.extension_server_pb.WriteCascadeEditRequest) returns (exa.extension_server_pb.WriteCascadeEditResponse);
  rpc StartAudioRecording(exa.extension_server_pb.StartAudioRecordingRequest) returns (exa.extension_server_pb.StartAudioRecordingResponse);
  rpc EndAudioRecording(exa.extension_server_pb.EndAudioRecordingRequest) returns (exa.extension_server_pb.EndAudioRecordingResponse);
  rpc GetCurrentAudioRecording(exa.extension_server_pb.GetCurrentAudioRecordingRequest) returns (exa.extension_server_pb.GetCurrentAudioRecordingResponse);
  rpc HandleProposeCodeExtensionVerification(exa.extension_server_pb.HandleProposeCodeExtensionVerificationRequest) returns (exa.extension_server_pb.HandleProposeCodeExtensionVerificationResponse);
  rpc UpdateCascadeTrajectorySummaries(exa.extension_server_pb.UpdateCascadeTrajectorySummariesRequest) returns (exa.extension_server_pb.UpdateCascadeTrajectorySummariesResponse);
  rpc RunExtensionCode(exa.extension_server_pb.RunExtensionCodeRequest) returns (exa.extension_server_pb.RunExtensionCodeResponse);
  rpc AddAnnotation(exa.extension_server_pb.AddAnnotationRequest) returns (exa.extension_server_pb.AddAnnotationResponse);
  rpc RemoveAnnotation(exa.extension_server_pb.RemoveAnnotationRequest) returns (exa.extension_server_pb.RemoveAnnotationResponse);
  rpc ShowAnnotation(exa.extension_server_pb.ShowAnnotationRequest) returns (exa.extension_server_pb.ShowAnnotationResponse);
  rpc GetSecretValue(exa.extension_server_pb.GetSecretValueRequest) returns (exa.extension_server_pb.GetSecretValueResponse);
  rpc StoreSecretValue(exa.extension_server_pb.StoreSecretValueRequest) returns (exa.extension_server_pb.StoreSecretValueResponse);
  rpc CancelVibeAndReplace(exa.extension_server_pb.CancelVibeAndReplaceRequest) returns (exa.extension_server_pb.CancelVibeAndReplaceResponse);
  rpc SearchQuery(exa.extension_server_pb.SearchQueryRequest) returns (exa.extension_server_pb.SearchQueryResponse);
  rpc GetClaudeCodeVersion(exa.extension_server_pb.GetClaudeCodeVersionRequest) returns (exa.extension_server_pb.GetClaudeCodeVersionResponse);
}

